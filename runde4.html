<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Zahlenfinde ‚Äì Runde 4 (fehlende Zahlen)</title>
  <style>
    * { box-sizing: border-box; user-select: none; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f3f4f6;
      color: #111827;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 24px 12px;
    }

    .game-container {
      width: 100%;
      max-width: 1200px;
      background: #ffffff;
      border-radius: 0;
      padding: 0 0 20px;
      box-shadow:
        0 12px 24px rgba(0,0,0,0.18),
        0 0 0 1px rgba(209,213,219,0.9);
      border-top: 6px solid #A6192E;
    }

    .game-header {
      padding: 14px 24px 10px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      gap: 16px;
      align-items: center;
      flex-wrap: wrap;
    }

    .title-block h1 {
      margin: 0;
      font-size: 1.6rem;
      letter-spacing: 0.02em;
      color: #A6192E;
      font-weight: 700;
    }

    .title-block p {
      margin: 4px 0 0;
      font-size: 0.9rem;
      color: #4b5563;
    }

    .info-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      justify-content: flex-end;
    }

    .badge,
    .stat {
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      color: #111827;
    }

    .badge {
      background: #A6192E;
      border-color: #A6192E;
      color: #ffffff;
      font-weight: 600;
    }

    .stat-label {
      color: #6b7280;
    }

    .controls-row {
      padding: 10px 24px 10px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #ffffff;
      color: #111827;
      font-size: 0.9rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.08s ease, box-shadow 0.08s ease,
                  background 0.12s ease, border 0.12s ease;
    }

    .btn-primary {
      border-color: #A6192E;
      background: #A6192E;
      color: #f9fafb;
      font-weight: 600;
      box-shadow: 0 8px 16px rgba(166,25,46,0.35);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 22px rgba(166,25,46,0.45);
    }

    .hint {
      font-size: 0.8rem;
      color: #6b7280;
    }

    .board-wrapper {
      position: relative;
      margin-top: 8px;
      padding: 0 24px 0;
    }

    .board {
      position: relative;
      width: 100%;
      aspect-ratio: 16 / 9;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      overflow: hidden;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-color: #ffffff;
    }

    .round-4 {
      background-image: url("runde4.png");
    }

    .number-bubble {
      position: absolute;
      transform: translate(-50%, -50%);
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #ffffff;
      text-shadow: 0 1px 2px rgba(0,0,0,0.4);
      box-shadow: 0 4px 8px rgba(0,0,0,0.25);
      padding: 0;
      border: 2px solid rgba(0,0,0,0.15);
    }

    .board.debug .number-bubble {
      outline: 1px dashed rgba(0,0,0,0.35);
    }

    .answer-panel {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .answer-panel input[type="number"] {
      width: 70px;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 0.9rem;
      text-align: center;
      transition: background-color 0.15s ease, border-color 0.15s ease;
    }

    .result-text {
      font-size: 0.9rem;
      margin-top: 6px;
    }

    .result-ok { color: #15803d; }
    .result-error { color: #b91c1c; }

    .overlay {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at center, rgba(17,24,39,0.55), rgba(17,24,39,0.8));
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }

    .overlay-card {
      background: #ffffff;
      border-radius: 10px;
      padding: 20px 22px;
      border: 1px solid #d1d5db;
      max-width: 440px;
      text-align: center;
      box-shadow: 0 18px 36px rgba(0,0,0,0.35);
    }

    .overlay-card h2 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 1.5rem;
      color: #A6192E;
    }

    .overlay-card p {
      margin: 4px 0;
      font-size: 0.95rem;
      color: #4b5563;
    }

    .overlay-buttons {
      margin-top: 16px;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    @media (max-width: 768px) {
      .game-container {
        padding-bottom: 14px;
      }
      .title-block h1 {
        font-size: 1.35rem;
      }
      .board-wrapper {
        padding: 0 12px;
      }
      .board {
        aspect-ratio: 9 / 16;
      }
    }
  </style>
</head>
<body>
<div class="game-container">
  <div class="game-header">
    <div class="title-block">
      <h1>Runde 4 ‚Äì Welche Zahlen fehlen?</h1>
      <p>Auf dieser Folie verstecken sich die Zahlen <strong>1 bis 49</strong> ‚Äì aber <strong>2 fehlen</strong>‚Ä¶</p>
    </div>
    <div class="info-grid">
      <div class="badge">
        üîç <span>Runde 4</span>
      </div>
      <div class="stat">
        <span class="stat-label">Fehlende Zahlen:</span>
        <span>genau 2</span>
      </div>
      <div class="stat">
        <span class="stat-label">Versuche √ºbrig:</span>
        <span id="attempts-label">5 / 5</span>
      </div>
    </div>
  </div>

  <div class="controls-row">
    <div class="answer-panel">
      <span class="hint">Trage die zwei fehlenden Zahlen ein:</span>
      <input type="number" id="guess1" min="1" max="49" />
      <input type="number" id="guess2" min="1" max="49" />
      <button class="btn btn-primary" id="check-btn">L√∂sung pr√ºfen</button>
    </div>
    <div>
      <div class="hint" id="cooldown-hint">
        Tipp: Du kannst auch erstmal nur eine Zahl eintragen und pr√ºfen.
      </div>
      <div id="result" class="result-text"></div>
    </div>
  </div>

  <div class="board-wrapper">
    <div class="board round-4" id="board"></div>

    <div class="overlay" id="overlay" style="display:none;">
      <div class="overlay-card" id="overlay-content"></div>
    </div>
  </div>
</div>

<script>
  const board = document.getElementById("board");
  const resultEl = document.getElementById("result");
  const guess1Input = document.getElementById("guess1");
  const guess2Input = document.getElementById("guess2");
  const checkBtn = document.getElementById("check-btn");
  const overlay = document.getElementById("overlay");
  const overlayContent = document.getElementById("overlay-content");
  const attemptsLabel = document.getElementById("attempts-label");
  const cooldownHint = document.getElementById("cooldown-hint");

  let missingNumbers = [];
  let layout = [];

  const MAX_ATTEMPTS = 5;
  const COOLDOWN_MS = 2 * 60 * 1000; // 2 Minuten
  let attemptsLeft = MAX_ATTEMPTS;
  let lockUntil = null;
  let cooldownInterval = null;

  const colorPalette = [
    "#A6192E",
    "#1F2933",
    "#2563EB",
    "#059669",
    "#D97706"
  ];

  const fontFamilies = [
    "system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif",
    "'Courier New', Courier, monospace",
    "Georgia, 'Times New Roman', serif"
  ];

  function updateAttemptsLabel() {
    attemptsLabel.textContent = `${attemptsLeft} / ${MAX_ATTEMPTS}`;
  }

  function setInputsEnabled(enabled) {
    guess1Input.disabled = !enabled;
    guess2Input.disabled = !enabled;
    checkBtn.disabled = !enabled;
  }

  function startCooldown() {
    lockUntil = Date.now() + COOLDOWN_MS;
    setInputsEnabled(false);

    if (cooldownInterval) clearInterval(cooldownInterval);

    cooldownInterval = setInterval(() => {
      const remaining = lockUntil - Date.now();
      if (remaining <= 0) {
        clearInterval(cooldownInterval);
        cooldownInterval = null;
        lockUntil = null;
        attemptsLeft = MAX_ATTEMPTS;
        updateAttemptsLabel();
        setInputsEnabled(true);
        cooldownHint.textContent = "Du hast wieder 5 neue Versuche. Nutze sie clever!";
        resultEl.textContent = "";
        resultEl.className = "result-text";
        return;
      }
      const secs = Math.ceil(remaining / 1000);
      const m = Math.floor(secs / 60);
      const s = secs % 60;
      const ss = String(s).padStart(2, "0");
      cooldownHint.textContent = `Du hast deine 5 Versuche verbraucht. Bitte warte ${m}:${ss} Minuten f√ºr neue Versuche.`;
    }, 500);
  }

  function decodeMissingFromCfg() {
    const params = new URLSearchParams(window.location.search);
    const cfg = params.get("cfg");
    if (!cfg) return null;

    let b64 = cfg.replace(/-/g, "+").replace(/_/g, "/");
    while (b64.length % 4 !== 0) {
      b64 += "=";
    }

    try {
      const raw = atob(b64);
      const parts = raw.split(",");
      if (parts.length < 2) return null;

      const n1 = parseInt(parts[0], 10);
      const n2 = parseInt(parts[1], 10);
      if (
        [n1, n2].some(n => isNaN(n) || n < 1 || n > 49) ||
        n1 === n2
      ) {
        return null;
      }

      return [Math.min(n1, n2), Math.max(n1, n2)];
    } catch (e) {
      return null;
    }
  }

  function rectsOverlap(a, b) {
    const ax1 = a.x - a.size / 2;
    const ax2 = a.x + a.size / 2;
    const ay1 = a.y - a.size / 2;
    const ay2 = a.y + a.size / 2;

    const bx1 = b.x - b.size / 2;
    const bx2 = b.x + b.size / 2;
    const by1 = b.y - b.size / 2;
    const by2 = b.y + b.size / 2;

    return ax1 < bx2 && ax2 > bx1 && ay1 < by2 && ay2 > by1;
  }

  function generateLayout(numbers) {
    const layout = [];
    const maxAttemptsPerNumber = 500;

    numbers.forEach(num => {
      let placed = false;
      let attempts = 0;

      while (!placed && attempts < maxAttemptsPerNumber) {
        attempts++;

        const size = 3.5 + Math.random() * 5; // kleinere + gr√∂√üere Bubbles
        const x = size / 2 + Math.random() * (100 - size);
        const y = size / 2 + Math.random() * (100 - size);

        const candidate = { number: num, x, y, size };

        const collision = layout.some(existing => rectsOverlap(candidate, existing));

        if (!collision) {
          layout.push(candidate);
          placed = true;
        }
      }

      if (!placed) {
        console.warn("Konnte Zahl nicht platzieren:", num);
      }
    });

    return layout;
  }

  function renderBoard() {
    board.innerHTML = "";
    layout.forEach(item => {
      const el = document.createElement("div");
      el.className = "number-bubble";
      el.textContent = item.number;

      el.style.left = item.x + "%";
      el.style.top = item.y + "%";
      el.style.width = item.size + "%";
      el.style.height = item.size + "%";

      // relative Fontgr√∂√üe ‚Äì etwas variieren
      const baseFontFactor = 0.55 + Math.random() * 0.25;
      el.style.fontSize = (item.size * baseFontFactor) + "vw";

      // Farbe
      const color = colorPalette[item.number % colorPalette.length];
      el.style.backgroundColor = color;

      // zuf√§llige Schriftart & Schriftschnitt
      const fontFamily = fontFamilies[item.number % fontFamilies.length];
      el.style.fontFamily = fontFamily;
      el.style.fontWeight = Math.random() > 0.5 ? "700" : "800";

      // leichte Rotation
      const rotation = (Math.random() - 0.5) * 24;
      el.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;

      board.appendChild(el);
    });
  }

  function showMissingParamInfo() {
    overlay.style.display = "flex";
    overlayContent.innerHTML = `
      <h2>Hinweis f√ºr Trainer</h2>
      <p>
        F√ºr diese Runde wurde kein g√ºltiger Konfigurationscode (<code>cfg</code>)
        in der URL gefunden.
      </p>
      <p style="margin-top:8px;font-size:.9rem;color:#444;">
        Bitte nutze die <strong>Host-Seite</strong>, um einen Link zu erzeugen,
        oder starte mit einer zuf√§lligen Auswahl.
      </p>
      <div class="overlay-buttons">
        <button class="btn btn-primary" id="random-missing-btn">Zuf√§llige fehlende Zahlen</button>
      </div>
    `;

    document.getElementById("random-missing-btn").addEventListener("click", () => {
      const all = Array.from({ length: 49 }, (_, i) => i + 1);
      const idx1 = Math.floor(Math.random() * all.length);
      const n1 = all.splice(idx1, 1)[0];
      const idx2 = Math.floor(Math.random() * all.length);
      const n2 = all[idx2];
      missingNumbers = [Math.min(n1, n2), Math.max(n1, n2)];
      startGame();
      overlay.style.display = "none";
    });
  }

  function startGame() {
    const allNumbers = Array.from({ length: 49 }, (_, i) => i + 1);
    const remaining = allNumbers.filter(n => !missingNumbers.includes(n));

    layout = generateLayout(remaining);
    renderBoard();

    attemptsLeft = MAX_ATTEMPTS;
    updateAttemptsLabel();
    setInputsEnabled(true);
    lockUntil = null;
    if (cooldownInterval) {
      clearInterval(cooldownInterval);
      cooldownInterval = null;
    }
    cooldownHint.textContent = "Tipp: Du kannst auch erstmal nur eine Zahl eintragen und pr√ºfen.";

    resultEl.textContent = "";
    resultEl.className = "result-text";
    guess1Input.value = "";
    guess2Input.value = "";
    guess1Input.style.backgroundColor = "";
    guess2Input.style.backgroundColor = "";
    guess1Input.style.borderColor = "#d1d5db";
    guess2Input.style.borderColor = "#d1d5db";
  }

  function checkSolution() {
    if (lockUntil && Date.now() < lockUntil) {
      return;
    }

    // Farben zur√ºcksetzen
    guess1Input.style.backgroundColor = "";
    guess2Input.style.backgroundColor = "";
    guess1Input.style.borderColor = "#d1d5db";
    guess2Input.style.borderColor = "#d1d5db";

    const g1 = parseInt(guess1Input.value, 10);
    const g2 = parseInt(guess2Input.value, 10);

    const filled1 = !Number.isNaN(g1);
    const filled2 = !Number.isNaN(g2);

    resultEl.textContent = "";
    resultEl.className = "result-text";

    if (!filled1 && !filled2) {
      resultEl.textContent = "Bitte trage mindestens eine Zahl zwischen 1 und 49 ein.";
      resultEl.classList.add("result-error");
      return; // kein Versuch verbraucht
    }

    if (filled1 && filled2 && g1 === g2) {
      resultEl.textContent = "Die zwei fehlenden Zahlen sind unterschiedlich ‚Äì bitte keine doppelte Zahl eingeben.";
      resultEl.classList.add("result-error");
      guess1Input.style.backgroundColor = "#fee2e2";
      guess2Input.style.backgroundColor = "#fee2e2";
      guess1Input.style.borderColor = "#b91c1c";
      guess2Input.style.borderColor = "#b91c1c";
      return; // kein Versuch verbraucht
    }

    const [a, b] = missingNumbers;

    let isG1Correct = false;
    let isG2Correct = false;

    if (filled1) {
      isG1Correct = (g1 === a || g1 === b);
      if (isG1Correct) {
        guess1Input.style.backgroundColor = "#dcfce7";
        guess1Input.style.borderColor = "#16a34a";
      } else {
        guess1Input.style.backgroundColor = "#fee2e2";
        guess1Input.style.borderColor = "#b91c1c";
      }
    }

    if (filled2) {
      isG2Correct = (g2 === a || g2 === b);
      if (isG2Correct) {
        guess2Input.style.backgroundColor = "#dcfce7";
        guess2Input.style.borderColor = "#16a34a";
      } else {
        guess2Input.style.backgroundColor = "#fee2e2";
        guess2Input.style.borderColor = "#b91c1c";
      }
    }

    const sortedMissing = [...missingNumbers].sort((x, y) => x - y);

    // Gewinnbedingung: beide Felder ausgef√ºllt und beide Zahlen exakt richtig
    let isWin = false;
    const bothFilled = filled1 && filled2;
    if (bothFilled) {
      const sortedGuess = [g1, g2].sort((x, y) => x - y);
      isWin = sortedGuess[0] === sortedMissing[0] && sortedGuess[1] === sortedMissing[1];
    }

    if (isWin) {
      resultEl.textContent = `‚úÖ Geschafft! Die fehlenden Zahlen sind ${sortedMissing[0]} und ${sortedMissing[1]}.`;
      resultEl.classList.add("result-ok");
      setInputsEnabled(false);
      if (cooldownInterval) {
        clearInterval(cooldownInterval);
        cooldownInterval = null;
      }
      cooldownHint.textContent = "Super! Du hast die Aufgabe gel√∂st.";

      overlay.style.display = "flex";
      overlayContent.innerHTML = `
        <h2>üéâ Gl√ºckwunsch, geschafft!</h2>
        <p>Du hast beide fehlenden Zahlen gefunden:</p>
        <p><strong>${sortedMissing[0]} und ${sortedMissing[1]}</strong></p>
        <p style="margin-top:8px;font-size:.9rem;color:#4b5563;">
          Genau so hilft Struktur im Alltag dabei, Dinge schneller zu finden.
        </p>
        <div class="overlay-buttons">
          <button class="btn btn-primary" id="close-success">Schlie√üen<


